<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Smart DL / RC Auto Cropper</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://unpkg.com/pdfjs-dist@3.4.120/build/pdf.min.js"></script>

<style>
:root{
  --bg:#0a1b30;
  --card:#0e2642;
  --muted:#a9bcd6;
  --accent:#5ab0ff;
  --glass:rgba(255,255,255,.05);
  --border:rgba(255,255,255,.10);
  --radius:12px;
  --shadow:0 6px 20px rgba(0,0,40,.45);
  --text:#e8f1ff;
}
body{
  margin:0;
  font-family:Inter,system-ui,sans-serif;
  background:linear-gradient(180deg,#0b1f3b 0%,#09315c 60%,#0a1b30 100%);
  color:var(--text);
  padding:28px;
}
h1{display:none}
#status{text-align:center;color:var(--muted);margin:12px 0}

.custom-file{
  display:inline-block;
  background:linear-gradient(180deg,rgba(90,176,255,.2),rgba(90,176,255,.12));
  border:1px solid rgba(90,176,255,.3);
  border-radius:999px;
  padding:12px 18px;
  cursor:pointer;
  font-weight:600;
  box-shadow:var(--shadow);
}
input{display:none}

#results{
  min-height:300px;
  border:2px solid rgba(90,176,255,.35);
  border-radius:var(--radius);
  background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(0,0,0,.1));
  padding:16px;
  box-shadow:var(--shadow);
}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:12px;
}
.grid div{
  background:rgba(255,255,255,.05);
  border:1px solid rgba(255,255,255,.08);
  border-radius:10px;
  padding:10px;
}
img{
  width:100%;
  height:150px;
  object-fit:contain;
  border-radius:6px;
  background:rgba(255,255,255,.08);
}
button{
  width:100%;
  margin-top:8px;
  padding:8px;
  border-radius:8px;
  border:1px solid rgba(90,176,255,.35);
  background:linear-gradient(90deg,rgba(90,176,255,.25),rgba(90,176,255,.15));
  color:var(--accent);
  font-weight:600;
  cursor:pointer;
}
</style>
</head>
<body>

<div style="display:flex;justify-content:center;margin-bottom:14px">
  <input type="file" id="file" accept="application/pdf" multiple>
  <label for="file" class="custom-file">üìÅ Choose PDF(s)</label>
</div>

<div id="status"></div>
<div id="results"></div>

<script type="text/babel">
pdfjsLib.GlobalWorkerOptions.workerSrc =
  "https://unpkg.com/pdfjs-dist@3.4.120/build/pdf.worker.min.js";

const DPI=600,W=85.6,H=53.98;
const mm=mm=>Math.round(mm*DPI/25.4);

function detectType(t){
  t=t.toLowerCase();
  if(t.includes("registration certificate")||t.includes("chassis")||t.includes("engine")) return "RC";
  if(t.includes("driving licence")||t.includes("dl no")) return "DL";
  return "DL";
}

function detectBBox(ctx,w,h,th){
  const d=ctx.getImageData(0,0,w,h).data;
  let t=h,b=0,l=w,r=0,f=false;
  for(let y=0;y<h;y++)for(let x=0;x<w;x++){
    const i=(y*w+x)*4;
    if(d[i]<th||d[i+1]<th||d[i+2]<th){
      f=true;
      if(x<l)l=x;if(x>r)r=x;if(y<t)t=y;if(y>b)b=y;
    }
  }
  return f?{x:l,y:t,w:r-l+1,h:b-t+1}:{x:0,y:0,w:w,h:h};
}

async function process(file,setPages){
  const buf=await file.arrayBuffer();
  const pdf=await pdfjsLib.getDocument({data:buf}).promise;
  let text="";
  for(let i=1;i<=Math.min(2,pdf.numPages);i++){
    const p=await pdf.getPage(i);
    const tc=await p.getTextContent();
    tc.items.forEach(it=>text+=it.str+" ");
  }
  const mode=detectType(text);
  document.getElementById("status").textContent=file.name+" ‚Üí "+mode;

  for(let i=1;i<=pdf.numPages;i++){
    const p=await pdf.getPage(i);
    const vp=p.getViewport({scale:6});
    const c=document.createElement("canvas");
    c.width=vp.width;c.height=vp.height;
    const cx=c.getContext("2d",{willReadFrequently:true});
    await p.render({canvasContext:cx,viewport:vp}).promise;

    const b=detectBBox(cx,c.width,c.height,mode==="RC"?250:240);
    const o=document.createElement("canvas");
    o.width=mm(W);o.height=mm(H);
    const ox=o.getContext("2d");
    ox.fillStyle="white";ox.fillRect(0,0,o.width,o.height);

    const pad=mode==="RC"?0:mm(2);
    const s=Math.min(o.width/(b.w+pad*2),o.height/(b.h+pad*2));

    ox.drawImage(c,0,0,c.width,c.height,
      (o.width-b.w*s)/2-b.x*s,
      (o.height-b.h*s)/2-b.y*s,
      c.width*s,c.height*s);

    setPages(pgs=>[...pgs,{url:o.toDataURL(),page:i,file:file.name}]);
  }
}

function App(){
  const [pages,setPages]=React.useState([]);

  React.useEffect(()=>{
    file.onchange=e=>{
      setPages([]);
      [...e.target.files].forEach(f=>process(f,setPages));
    };
  },[]);

  return(
    <div className="grid">
      {pages.map((p,i)=>(
        <div key={i}>
          <img src={p.url}/>
          <button onClick={()=>{
            const a=document.createElement("a");
            a.href=p.url;
            a.download=p.file.replace(/\.pdf$/i,"")+"_"+p.page+".png";
            a.click();
          }}>Download</button>
        </div>
      ))}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("results")).render(<App/>);
</script>
</body>
</html>
